# ポケモンカードバトル 仕様（簡易版・自動進行）

本仕様は、本ディレクトリの `index.html`/`styles.css`/`js/` に実装される「人間 vs CPU」の簡易版ポケモンカードバトルの設計書です。標準ルールの一部を簡略化しています。目的は「ゲームスタートから終了までのフローが一貫して動くこと」と「レンダリングと攻撃演出をリッチにすること」です。

## 全体アーキテクチャ
- ローダー: `js/loader.js`
  - `cards.json` を読み込み、カードデータを正規化（id/name/supertype/types/hp/attacks/image）。
  - 画像パスは `images.large|small` が無ければ `assets/<id>.jpg` を推測。
- ゲームロジック: `js/game.js`
  - ゲーム状態（プレイヤー、ターン、フェーズ、山札/手札/場/トラッシュ/サイド）を管理。
  - ターン進行（ドロー→自動エネルギー1枚付与→攻撃→ターン終了）を自動。
  - きぜつ判定、サイド取得、勝敗判定まで。
- レンダリング: `js/renderer.js`
  - 盤面（相手/自分のアクティブ、ベンチ、山札、トラッシュ、サイド、手札）をDOMで描画。
  - 攻撃演出時にキャンバスFXを呼び出し、被弾側にエフェクトクラスを付与。
- アニメーションFX: `js/fx.js`
  - Canvas 2D によるビーム、リング、爆発、スパークの演出。
  - 要素中心点→中心点のビームライン描画、被弾点のエフェクト。
- エントリポイント: `js/main.js`
  - 人間ターン時に行動UI（エネルギー付与/攻撃/ターン終了）を提示。
  - UI（フェーズ表示/ログ/ボタン）とロジック/レンダリングの橋渡し。

## フロー詳細
1. 起動/読込
   - `cards.json` を読み込み正規化。失敗時はフェーズ/ログへエラー表示。
2. 初期化
   - 両者のデッキを自動構築（簡略: ポケモン20、エネルギー40）。
   - 各プレイヤーは7枚ドロー、サイド6枚をセット。
   - 手札から最初のポケモンをアクティブに、自動で最大3枚までベンチに配置。無ければ山から探す簡易マリガン。
3. 先攻決定
   - 簡略化のためプレイヤーが先攻。
4. ターン開始
   - 1枚ドロー。
   - 人間: UIで「エネルギー付与」可（1ターン1回）。
   - CPU: 可能なら自動で1枚付与。
5. 攻撃
   - 人間: 支払可能なワザの中から選択。
   - CPU: アクティブのワザから最大ダメージのものを自動選択。
   - 支払可否（必要エネ数≦付与枚数）の簡易判定（タイプ一致は未考慮）。
   - 攻撃演出（ビーム→スパーク/リング/爆発）→ダメージ適用。
6. きぜつ/サイド/昇格
   - HPが0以下で気絶、トラッシュへ。
   - 攻撃側はサイドを1枚取得。
   - 防御側はベンチ先頭をアクティブへ昇格（あれば）。
7. 勝敗判定
   - サイドが0枚、または相手のアクティブ不在で勝利。
8. ターン終了→相手ターンへ交代し繰返し。

## 簡略/割愛事項（将来拡張）
- 弱点/抵抗、状態異常、逃げる、進化、特性、トレーナーズ、特殊エネルギー、ルールボックス（V/GX/VSTAR等）。
- コストのタイプ整合性（現状は必要枚数のみ）。

## 画面構成/UI
- 盤面: 相手ゾーン（上段）/自分ゾーン（下段）/中央Canvas。
- 山札とサイドはカード背面で描画（`assets` 内の背面画像を使用）。
- トラッシュは枚数表示。
- 手札は自分のみ一覧表示。
- サイドバー: フェーズ、操作ボタン（現状は開始/再開のみ）、ログ。

## コードと仕様の対応
- 読込: `loadCards()` → 正規化 → 画像パス解決（仕様「起動/読込」）。
- 初期化: `Game.start()` → デッキ作成、ドロー、サイド設定、配置（仕様「初期化」）。
- ターン進行: `beginTurn()` → ドロー、エネルギー付与、攻撃選択（仕様「ターン開始」「攻撃」）。
- ダメージ/きぜつ/サイド: `performAttack()`（仕様「きぜつ/サイド/昇格」「勝敗判定」）。
- レンダリング: `Renderer.render()`（仕様「画面構成/UI」）。
- 攻撃FX: `Renderer.animateAttack()` → `FX.attack()/impactAtEl()`（仕様「アニメーションFX」）。

## 動作要件
- `index.html` と同ディレクトリに `cards.json`、`assets/`（カード画像）を配置。
- 背面画像は `assets/back.jpg`（推奨）。`back.png`/`card-back.jpg` 等も自動検出。
- ブラウザで `index.html` を開く。

## 画像形式（WebP対応）
- 前面画像と背面画像は `.webp` を優先して利用可能です。`.png/.jpg/.jpeg` もフォールバック候補に含めています。
- 探索順（前面）: `images.large` → `images.small` → `image` → `assets/<id>.(webp|png|jpg|jpeg)` → `assets/<sanitized name>.(webp|png|jpg|jpeg)`。
- 探索順（背面）: `assets/back.webp` → `assets/back.(png|jpg)` → `assets/card-back.(webp|png|jpg)` → `assets/card_back.(webp|png|jpg)` → `assets/pokemon-back.*` → `assets/pokemon_back.*`。
