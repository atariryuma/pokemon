# ポケモンカードバトルゲーム 要件定義書（ドラフト）

本書は現行ドキュメント（docs/*.md）を前提にした要件の整理ドラフトです。本環境ではdocsの内容を取得できなかったため、標準TCGルールと一般的UI要件に基づく仮定を含みます。実ドキュメントで照合し、差分を確定してください。

## 1. スコープ
- 対象: 対人対戦可能なポケモン風TCGエンジン、UI、基本アニメーション。
- 非対象: マッチメイキング、課金、サーバ運用。

## 2. ドメイン要件（ゲームルール）
- エンティティ: ポケモン（Basic/Stage1/Stage2, HP, タイプ, 弱点/抵抗, 逃げる, 特性, ワザ, ルールボックス）, エネルギー（基本/特殊）, トレーナーズ（グッズ/サポート/スタジアム）。
- ゾーン: 山札/手札/バトル場/ベンチ(最大5)/トラッシュ/サイド/ロスト（必要時）/スタジアム。
- 準備: 山札60枚, 先攻後攻, 初手7枚, ベーシック配置, サイド6枚, マリガン。
- ターン: ドロー→主要フェイズ（展開/進化/1ターン1エネ/グッズ/サポート/スタジアム/特性/1回までのにげる）→ワザ→ダメージ/効果→きぜつ/サイド取得。
- 効果/判定: 弱点/抵抗, 特殊状態（どく/やけど/ねむり/まひ/こんらん）, コイン判定（シード固定）。
- 勝利条件: サイド取り切り/場のポケモン不在/山札切れドロー不可。

## 3. UI/UX要件（重点）
- レイアウト/デザイン:
  - バトル画面: 2プレイヤー対称レイアウト（バトル場1, ベンチ5, 手札エリア, サイド, トラッシュ, スタジアム）。
  - レスポンシブ: 16:9基準, 最小幅≧1024px, 縦画面はスタック配置。（優先度: 高）
  - コンポーネント: `Card`, `Zone`, `Board`, `Hand`, `Prize`, `Discard` の責務分離。（高）
  - 視覚階層: フォーカス中カードを拡大, 影/レイヤーで優先度表現。（中）
- 画像はめ込み（課題):
  - フレームテンプレート+アート領域のセーフエリア定義（px/比率）。
  - トリミング規則: cover優先, 中央基準, 顔検出/手動オフセット（将来）。
  - アスペクト比: 744x1039基準（任意例）, 高DPI 2x/3x, プレースホルダー/ローディング骨格。（高）
- アニメーション（課題）:
  - 基本: ドロー, 配置, 進化, エネ付与, にげる, ワザ解決, きぜつ/サイド取得。
  - 時間/イージング: 120–240ms, ease-out/standard curve, `prefers-reduced-motion` 準拠。（高）
  - 状態遷移: フェーズ変更時の段階表示, キュー駆動で同時演出を直列化。（中）

## 4. エンジン/データ要件
- 状態: ゲームスナップショット（各ゾーン, ターン, RNGシード, スタック）をシリアライズ可能。
- 検証: デッキ/行為の合法性, 1ターン1回制限の追跡。
- カード定義: 正規化スキーマ（id, 名称, 種別, ステージ, HP, タイプ, コスト, テキスト, ルールボックス, セット, 禁止/エラッタ）。
- ログ: 監査可能なイベントログ/リプレイ。（将来Undoはテスト限定）

## 5. 非機能要件
- パフォーマンス: 60fps目標（モーション軽量化）, 初期ロード<2s@良回線。（高）
- アクセシビリティ: キーボード操作, コントラスト比, スクリーンリーダーラベル。（中）
- i18n: ja/ENの文言分離。（中）

## 6. テスト
- 単体: 進化タイミング/弱点抵抗/特殊状態/にげる/ドロー順。
- シナリオ: セットアップ→ワザ→きぜつ→サイド取得。
- ビジュアル: 重要画面のスナップショット/回帰（Storybook/Playwright等）。
- 目標: カバレッジ≧80%, RNGシード固定で再現性。

## 7. 既知の不足/改善ポイント
- レイアウト: 小画面時の崩れ/オーバーフロー。対応: 自動グリッド, 最小幅, ゾーン折りたたみ。
- デザイン: 状態の視覚差不足。対応: 色/アイコン/トークン設計とデザインシステム化。
- アニメーション: 冗長/同時進行の競合。対応: イベントキュー+並列/直列制御, reduce-motion対応。
- 画像はめ込み: 比率違い/切抜き不整合。対応: セーフエリアとトリミング規約, プレースホルダー/エラー処理。

## 8. 要確認（docsから確定が必要）
- 先攻の行動制限/サイド枚数/独自ルールの有無。
- 対応カード種（V/EX/VMAX等ルールボックス）の範囲。
- アニメーション基準/デザイントークン（色/タイポ/スペーシング）。
- 画像素材の提供形式/解像度/著作権ポリシー。

ドラフト確定後、画面ワイヤー/モーション仕様/画像テンプレの3点を先行で確定し、実装に反映します。
