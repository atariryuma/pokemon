## 要件定義：ポケモンカードバトルHTMLゲーム（完全版）

### 1. リポジトリ構成把握
- **ルート**  
  - `index.html`, `styles.css`: エントリーポイントと共通スタイル  
  - `cards.json`: カードデータ（ポケモン・エネルギー）  
  - `assets/`: カード画像・背面画像・エネルギーJSONなど  
  - `js/`: ゲームロジック／描画／エンジン等モジュール  
  - `docs/`: ルール・仕様・アニメーション計画などのドキュメント
- **js モジュール**  
  - `loader.js`, `cards.js`: カードデータ読み込みと正規化  
  - `state.js`: ゲームステート定義  
  - `logic.js`: ルール処理（ドロー、進化、攻撃、勝敗判定等）  
  - `engine.js`, `game.js`: コントローラ／ゲームループ  
  - `renderer.js`, `view.js`: DOM描画・アニメーション起動  
  - `fx.js`, `animations.js`: キャンバスFXやCSSアニメーション管理  
  - `main.js`, `boot.js`, `app.js`: 初期化・エントリポイント
- **docs 主要内容**  
  - `REQUIREMENTS.md`: ドメイン要件・UI/UX・非機能要件のドラフト  
  - `SPEC.md`: 簡易版ゲーム仕様（自動進行・攻撃演出）  
  - `animations.md`: CSS主体のアニメーション一覧と実装方針  
  - `card_details.md`: `cards.json` の構造・各カードの詳細  
  - `field-specifications.md`: フィールドレイアウト、デザインシステム  
  - `game_sequence.md`: フェーズごとの詳細シーケンス  
  - `rulebook.md`: 初心者向けルール解説

### 2. 目的
ブラウザのみで動作する「プレイヤー vs CPU」ポケモンカードバトルをフルルール対応で実装し、公式TCGに近い体験を提供する。  
今後のオンライン対戦・デッキ編集など拡張が可能なアーキテクチャを採用する。

### 3. 機能要件
#### 3.1 ゲームルール
1. **カードスキーマ**
   - ポケモン／エネルギー／トレーナーズの3種
   - ポケモン: id, name, stage, hp, types, weakness, resistance, retreat_cost, ability, attacks, rule_box 等
   - エネルギー: id, energy_type, is_basic, text 等
   - トレーナーズ: id, trainer_type(Item/Supporter/Stadium), text

2. **ゾーン**
   - 山札、手札、バトル場、ベンチ（最大5）、トラッシュ、サイド（6枚）、スタジアム、ロスト（必要時）

3. **セットアップ**
   - デッキ60枚シャッフル→7枚ドロー→マリガン処理
   - たねポケモンをバトル場・任意でベンチへ、サイド6枚を裏向きに配置
   - 先攻/後攻決定、ターン1から開始

4. **ターン進行**
   - `startTurn`: ドロー不可で敗北、エネ付与権・にげる権初期化
   - `mainPhase`（任意順）：  
     - ベンチ展開（たね）  
     - 進化（出たターン不可）  
     - エネルギー1枚付与  
     - アイテム無制限／サポート1枚／スタジアム入れ替え  
     - 特性使用  
     - にげる（1回、コスト支払い）  
     - 攻撃宣言 → ダメージ計算（弱点×2、抵抗力−N）  
       - 特殊状態：どく/やけど/ねむり/まひ/こんらん  
       - ルールボックス(V/EX/VMAX etc.)対応  
     - きぜつ処理→サイド取得→バトルポケモン昇格  
   - `endTurn`: フェーズ交代

5. **勝利条件**
   - サイド全取得／相手のポケモン不在／山札切れドロー不可

#### 3.2 AI（CPU）
- 基本的な行動選択（エネ付与・進化・攻撃）を実装  
- 戦略拡張: 優先度付き行動、特性・トレーナーズの使用、にげる判断等

#### 3.3 アニメーション
- ドロー、配置、進化、エネルギー付与、攻撃、ダメージ、きぜつ、カード裏返し等  
- CSSクラス付与で制御し `transitionend/animationend` で後処理  
- Canvas (`fx.js`) によるビーム・爆発・リング・スパーク効果  
- `prefers-reduced-motion` 対応、120–240ms程度のイージング

### 4. UI/UX要件
1. **レイアウト**
   - 16:9前提のレスポンシブ。上段CPU、下段プレイヤー  
   - 盤面: バトル場/ベンチ/手札/山札/トラッシュ/サイド/スタジアム/ログ  
   - ゾーンごとにDOM分割し `renderer.js` / `view.js` で再描画

2. **インタラクション**
   - カード選択/ドラッグ（将来）/ホバーズーム/クリックで使用  
   - ゾーン間移動: 手札→ベンチ/アクティブ、ベンチ↔アクティブ、アクティブ→トラッシュ 等  
   - 状態表示: 選択可能・選択中・無効・ホバー時の視覚的フィードバック

3. **アクセシビリティ & i18n**
   - `aria-*` ラベル、キーボード操作、コントラスト確保  
   - 文言の日本語/英語分離、切替対応

4. **ビジュアル**
   - `field-specifications.md` のデザインシステム: カラーパレット、タイポ、スペーシング、カード比率（80x112px基準）  
   - フォーカスカード拡大、影・レイヤーで視線誘導

### 5. 資産（assets フォルダ）
- ポケモン画像 (`*.webp`, `*.png`, `*.jpg`)  
- エネルギー画像＆JSON（例: `Energy_Grass.webp` + `Energy_Grass.json`)  
- 背面画像: `back.webp` など自動検出  
- `loader.js` で `cards.json` と照合し欠損時フォールバックを探索

### 6. システムアーキテクチャ
1. **データ層** (`cards.js`, `cards.json`, energy JSON)  
2. **ロジック層** (`logic.js`, `state.js`) – 純粋関数で状態遷移  
3. **レンダリング層** (`renderer.js`, `view.js`) – DOM操作とアニメーション  
4. **コントローラ層** (`game.js`, `engine.js`) – ユーザー入力／CPU行動／ゲームループ  
5. **FX層** (`fx.js`, `animations.js`) – 視覚効果・CSSアニメ制御  
6. **起動** (`main.js`, `boot.js`, `app.js`) – 依存読込とゲーム開始

### 7. 非機能要件
- **パフォーマンス**: 60fps目標、初期ロード<2s（カード画像は遅延ロード）  
- **テスト**: 単体テスト（進化・弱点・特殊状態・にげる等）、シナリオテスト（セットアップ→攻撃→勝利）、ビジュアルリグレッション  
- **ログ/リプレイ**: すべての行動を記録しデバッグ・リプレイ可能  
- **シリアライズ**: RNGシードを含むゲームスナップショット保存/復元

### 8. 開発ロードマップ（例）
1. **フェーズ1**: 既存簡易版をフルルールへ拡張（進化/弱点/トレーナーズ/特殊状態）  
2. **フェーズ2**: アニメーション統合・ダメージエフェクト・勝利演出  
3. **フェーズ3**: ドラッグ&ドロップ、カード詳細ズーム、ショートカット  
4. **フェーズ4**: デッキ編集、戦績管理、オンライン対戦

---

この要件定義を基に、`docs/` の仕様内容をすべて実現し、`assets/` と `js/` の全モジュールを活用した「完璧なポケモンカードバトルHTMLゲーム」を段階的に開発していきます。
