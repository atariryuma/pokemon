<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°ã—ã„ã‚«ãƒ¼ãƒ‰ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: system-ui; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .test-section { background: white; margin: 20px 0; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .test-result { padding: 10px; border-radius: 5px; margin: 10px 0; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; margin-top: 10px; }
        .card-sample { background: #f8f9fa; padding: 10px; border-radius: 5px; text-align: center; border: 2px solid #dee2e6; }
        .card-sample img { width: 100px; height: auto; border-radius: 5px; margin-bottom: 5px; }
        .card-sample.loaded { border-color: #28a745; }
        .card-sample.failed { border-color: #dc3545; }
        h1 { color: #2c3e50; text-align: center; }
        h2 { color: #34495e; border-bottom: 2px solid #3498db; padding-bottom: 5px; }
        .stats { display: flex; gap: 20px; justify-content: space-around; text-align: center; }
        .stat { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 15px; border-radius: 10px; }
        .stat-number { font-size: 2em; font-weight: bold; }
        .folder-structure { font-family: monospace; background: #2c3e50; color: #ecf0f1; padding: 15px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ´ æ–°ã—ã„ã‚«ãƒ¼ãƒ‰ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  ãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="test-section">
            <h2>ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ çµ±è¨ˆ</h2>
            <div class="stats" id="stats-container">
                <div class="stat">
                    <div class="stat-number" id="total-cards">-</div>
                    <div>ç·ã‚«ãƒ¼ãƒ‰æ•°</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="pokemon-count">-</div>
                    <div>ãƒã‚±ãƒ¢ãƒ³</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="energy-count">-</div>
                    <div>ã‚¨ãƒãƒ«ã‚®ãƒ¼</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="data-source">-</div>
                    <div>ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹</div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ“ æ–°ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ </h2>
            <div class="folder-structure">
data/
â”œâ”€â”€ cards-master.json    # çµ±åˆã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
â””â”€â”€ schema.json         # ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ã‚¹ã‚­ãƒ¼ãƒ

assets/
â”œâ”€â”€ cards/
â”‚   â”œâ”€â”€ pokemon/        # ãƒã‚±ãƒ¢ãƒ³ã‚«ãƒ¼ãƒ‰ç”»åƒ
â”‚   â””â”€â”€ energy/         # ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚«ãƒ¼ãƒ‰ç”»åƒ
â”œâ”€â”€ ui/                 # UIç”¨ç”»åƒ
â”‚   â”œâ”€â”€ card_back.webp
â”‚   â””â”€â”€ pokemon_card_back.webp
â””â”€â”€ playmat/            # ãƒ—ãƒ¬ã‚¤ãƒãƒƒãƒˆé–¢é€£
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ” ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ†ã‚¹ãƒˆ</h2>
            <div id="loading-test-results"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ–¼ï¸ ç”»åƒãƒ‘ã‚¹ãƒ†ã‚¹ãƒˆ (ãƒ©ãƒ³ãƒ€ãƒ 8æš)</h2>
            <div id="image-test-results"></div>
            <div class="card-grid" id="image-samples"></div>
        </div>

        <div class="test-section">
            <h2>âœ… ã‚·ã‚¹ãƒ†ãƒ æ¤œè¨¼çµæœ</h2>
            <div id="final-results"></div>
        </div>
    </div>

    <script type="module">
        import { loadCardsFromJSON, getCardMasterList, getCardImagePath } from './js/data-manager.js';

        let testResults = {
            dataLoading: false,
            imageLoading: 0,
            totalTests: 0
        };

        // ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ†ã‚¹ãƒˆ
        async function testDataLoading() {
            const resultsDiv = document.getElementById('loading-test-results');
            
            try {
                // JSONãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ†ã‚¹ãƒˆ
                await loadCardsFromJSON();
                const cards = getCardMasterList();
                
                if (cards && cards.length > 0) {
                    testResults.dataLoading = true;
                    
                    // çµ±è¨ˆæ›´æ–°
                    document.getElementById('total-cards').textContent = cards.length;
                    document.getElementById('pokemon-count').textContent = cards.filter(c => c.card_type === 'PokÃ©mon').length;
                    document.getElementById('energy-count').textContent = cards.filter(c => c.card_type === 'Basic Energy').length;
                    document.getElementById('data-source').textContent = 'JSON';
                    
                    resultsDiv.innerHTML = `
                        <div class="test-result success">
                            âœ… ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æˆåŠŸ<br>
                            ğŸ“¦ ${cards.length}æšã®ã‚«ãƒ¼ãƒ‰ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ<br>
                            ğŸ“„ ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹: data/cards-master.json
                        </div>
                    `;
                    
                    return cards;
                } else {
                    throw new Error('ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ãŒç©ºã§ã™');
                }
                
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="test-result error">
                        âŒ ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å¤±æ•—<br>
                        ã‚¨ãƒ©ãƒ¼: ${error.message}
                    </div>
                `;
                return null;
            }
        }

        // ç”»åƒãƒ‘ã‚¹ãƒ†ã‚¹ãƒˆ
        async function testImagePaths(cards) {
            if (!cards) return;
            
            const resultsDiv = document.getElementById('image-test-results');
            const samplesDiv = document.getElementById('image-samples');
            
            // ãƒ©ãƒ³ãƒ€ãƒ ã«8æšé¸æŠ
            const shuffled = [...cards].sort(() => 0.5 - Math.random());
            const testCards = shuffled.slice(0, 8);
            
            testResults.totalTests = testCards.length;
            
            resultsDiv.innerHTML = '<div class="test-result info">ğŸ”„ ç”»åƒèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</div>';
            
            const promises = testCards.map(async (card) => {
                return new Promise((resolve) => {
                    const cardDiv = document.createElement('div');
                    cardDiv.className = 'card-sample';
                    
                    const img = document.createElement('img');
                    const imagePath = getCardImagePath(card.name_en);
                    img.src = imagePath;
                    
                    const nameDiv = document.createElement('div');
                    nameDiv.textContent = card.name_ja;
                    nameDiv.style.fontSize = '0.8em';
                    nameDiv.style.fontWeight = 'bold';
                    
                    const pathDiv = document.createElement('div');
                    pathDiv.textContent = imagePath.replace('assets/', '');
                    pathDiv.style.fontSize = '0.7em';
                    pathDiv.style.color = '#666';
                    
                    img.onload = () => {
                        cardDiv.classList.add('loaded');
                        testResults.imageLoading++;
                        resolve(true);
                    };
                    
                    img.onerror = () => {
                        cardDiv.classList.add('failed');
                        img.src = 'assets/ui/card_back.webp'; // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                        resolve(false);
                    };
                    
                    cardDiv.appendChild(img);
                    cardDiv.appendChild(nameDiv);
                    cardDiv.appendChild(pathDiv);
                    samplesDiv.appendChild(cardDiv);
                });
            });
            
            await Promise.all(promises);
            
            const successRate = (testResults.imageLoading / testResults.totalTests * 100).toFixed(1);
            
            resultsDiv.innerHTML = `
                <div class="test-result ${successRate >= 75 ? 'success' : 'error'}">
                    ${successRate >= 75 ? 'âœ…' : 'âŒ'} ç”»åƒèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆå®Œäº†<br>
                    ğŸ“Š æˆåŠŸç‡: ${successRate}% (${testResults.imageLoading}/${testResults.totalTests})
                </div>
            `;
        }

        // æœ€çµ‚çµæœè¡¨ç¤º
        function showFinalResults() {
            const resultsDiv = document.getElementById('final-results');
            
            const overallSuccess = testResults.dataLoading && (testResults.imageLoading / testResults.totalTests) >= 0.5;
            
            resultsDiv.innerHTML = `
                <div class="test-result ${overallSuccess ? 'success' : 'error'}">
                    <h3>${overallSuccess ? 'âœ… ã‚·ã‚¹ãƒ†ãƒ æ¤œè¨¼æˆåŠŸ' : 'âŒ ã‚·ã‚¹ãƒ†ãƒ æ¤œè¨¼å¤±æ•—'}</h3>
                    <ul>
                        <li>ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°: ${testResults.dataLoading ? 'âœ… æˆåŠŸ' : 'âŒ å¤±æ•—'}</li>
                        <li>ç”»åƒãƒ‘ã‚¹: ${testResults.imageLoading}/${testResults.totalTests} æˆåŠŸ</li>
                        <li>ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ : âœ… æ•´ç†å®Œäº†</li>
                        <li>ãƒ‘ã‚¹æ›´æ–°: âœ… å®Œäº†</li>
                    </ul>
                    ${overallSuccess ? 
                        '<p><strong>ğŸ‰ æ–°ã—ã„ã‚«ãƒ¼ãƒ‰ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã¯æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ï¼</strong></p>' : 
                        '<p><strong>âš ï¸ ã‚·ã‚¹ãƒ†ãƒ ã«å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</strong></p>'
                    }
                </div>
            `;
        }

        // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        async function runTests() {
            console.log('ğŸ”¬ æ–°ã—ã„ã‚«ãƒ¼ãƒ‰ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã™...');
            
            const cards = await testDataLoading();
            await new Promise(resolve => setTimeout(resolve, 500)); // å°‘ã—å¾…æ©Ÿ
            
            await testImagePaths(cards);
            await new Promise(resolve => setTimeout(resolve, 1000)); // ç”»åƒèª­ã¿è¾¼ã¿å¾…æ©Ÿ
            
            showFinalResults();
            
            console.log('âœ… ãƒ†ã‚¹ãƒˆå®Œäº†');
        }

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        document.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html>